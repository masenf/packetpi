---
- hosts: all
  gather_facts: no
  any_errors_fatal: true
  vars:
    callsign: KF7HVM
    direwolf_mycall: "{{ callsign }}-7"
    direwolf_mycall2: "{{ callsign }}-8"
    node_callsign: "{{ callsign }}-9"
    nralias: "COW"
    nrpassword: testing
  tasks:
    - name: load snd-aloop module [TEST]
      modprobe:
        name: snd-aloop
        state: present
    - name: load snd-aloop module on boot [TEST]
      ansible.builtin.copy:
        content: 'snd-aloop'
        dest: /etc/modules-load.d/snd-aloop.conf
        owner: root
        group: root
        mode: '0644'
  roles:
    - role: ax25
      become: True
      axports:
        - name: direwolf1
          description: kiss over TCP
          direwolf:
            - adevice: plughw:0,1,1 plughw:0,0,0
              channel: 0
              mycall: "{{ direwolf_mycall }}"
              modem: 1200
              kissport: 8010
          netrom:
            name: netrom
            callsign: "{{ direwolf_mycall }}"
            alias: "{{ nralias }}"
            dev: nr0
            description: direwolf1 tnc port
        - name: direwolf2
          callsign: "{{ direwolf_mycall2 }}"
          direwolf:
            - adevice: plughw:0,1,0 plughw:0,0,1
              channel: 0
              mycall: "{{ direwolf_mycall2 }}"
              modem: 1200
              kissport: 8011
#        - name: local_tnc
#          callsign: "{{ callsign }}"
#          speed: 1200
#          description: kiss over serial
#          serialPort: /dev/USB0
      ax25d:
        - callsign: "{{ node_callsign }}"
          axport: direwolf1
          user: node
          program: /usr/sbin/ax25-node
          program_name: ax25-node 
      netrom:
        - nrport: netrom
          user: node
          program: /usr/sbin/ax25-node
          program_name: ax25-node 
    - role: node
      become: True
